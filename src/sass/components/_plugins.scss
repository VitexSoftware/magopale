@use "sass:math";
@use "../variables";
@use "../vendor/font-awesome/variables" as fa-variables;
@use "../mixins/variants";
@use "../components/icons";

// Additionals
// https://www.redmine.org/plugins/additionals

#sidebar .dashboards .dashboard-system-default {
  position: absolute;
  transform: translateY(-175%);
  @if variables.$sidebar-position == "right" {
    right: 15px;
  }
}

.flyout-menu .dashboard-system-default {
  position: absolute;
  right: 10px;
  transform: translateY(-190%);
}

#sidebar .sidebar-additionals {
  ul,
  ol {
    margin: 0 0 (variables.$line-height-computed * .5);
    padding-left: 1.5em;

    ul,
    ol {
      margin-bottom: 0;
    }
  }

  ul {
    // stylelint-disable selector-max-compound-selectors
    li {
      list-style-type: disc;

      li {
        list-style-type: circle;

        li {
          list-style-type: square;
        }
      }
    }
  }
}

.action-login .login-additionals {
  font-size: 1em;

  @media screen and (min-width: variables.$login-form-box-breakpoint) {
    max-width: variables.$login-form-width;
  }
}

#my-page.dashboard {
  .mypage-box:not(.block-welcome, .block-projectinformation, .block-text, .block-text_async) {
    margin-bottom: variables.$line-height-computed;
    padding: variables.$panel-body-padding;
    border: 1px solid variables.$panel-border;
    border-radius: variables.$border-radius-base;
    background-color: variables.$panel-bg;
    color: variables.$panel-color;
    font-size: .92em;
    word-wrap: break-word;

    > h3 {
      margin-bottom: variables.$panel-body-padding-vertical;
    }
  }
}

.controller-rdb_taskboard .gototop {
  margin-right: variables.$padding-side;
}


// Additional tags
// https://www.redmine.org/plugins/additional_tags

.issue .tags.attribute {
  padding-left: 160px;

  .label {
    width: 160px;
    margin-left: -160px;
  }

  #tags-data {
    padding-top: 3px;
  }
}

#main {
  .additional-tag-label-color {
    font-weight: 600;
    text-transform: uppercase;
  }

  #admin-menu a.additional-tags::before {
    font-size: 1em;
  }
}

#wiki_tags,
#edit-tags-form {
  .select2-container {
    margin-bottom: 5px;

    &.select2-container--default .select2-selection--multiple .select2-selection__rendered {
      margin: 0;
      padding: 3px;
    }
  }
}


// Redmine Dashboard
// https://www.redmine.org/plugins/redmine-dashboard

@if variables.$enable-sidebar-toggler {
  #main {
    // Fix full screen view
    @at-root .controller-rdb_taskboard & {
      position: static;
    }
  }
}

#rdb-taskboard {
  #rdb-header {
    a#rdb-refresh {
      padding: 2px 0;
      border-width: 0;
      background-image: none;
      line-height: 1.2em;

      &::before {
        content: "\f021";
        display: block;
        width: 1em;
        margin: 0 auto;
        color: variables.$green;
        font-family: FontAwesome;
        line-height: 1.2em;
      }
    }

    .rdb-board .rdb-menu h2 {
      font-size: 1em;
    }

    .rdb-board,
    .rdb-filter,
    .rdb-option {
      margin-top: 4px;
      margin-bottom: 0;
    }
  }

  a#rdb-refresh,
  a#rdb-refresh:focus,
  a#rdb-refresh:hover,
  .rdb-menu-link,
  .rdb-menu-link:focus,
  .rdb-menu-link:hover,
  .rdb-menu .rdb-list a,
  .rdb-menu .rdb-list a:focus,
  .rdb-menu .rdb-list a:hover {
    color: variables.$gray-900;
    text-decoration: none;
  }

  div:not(.rdb-card-header, .rdb-compact-header, .rdb-card-title) .rdb-menu {
    .rdb-list {
      > ul > li > a,
      .rdb-multicheck a {
        padding: 3px 5px;
      }

      .rdb-checkbox-link.rdb-checkbox-link-enabled {
        background-image: none;

        &::before {
          content: "\f00c";
          display: inline-block;
          color: variables.$green;
          font-family: FontAwesome;
        }
      }

      .rdb-checkbox-link.rdb-checkbox-link-disabled {
        padding: 0;
        background-image: none;
      }

      a {
        font-size: .9em;

        &#rdb-reset {
          background-image: none;

          &::before {
            content: "\f00d";
            display: inline-block;
            margin-right: 8px;
            font-family: FontAwesome;
          }
        }
      }
    }

    &.rdb-menu-right .rdb-checkbox-link.rdb-checkbox-link-enabled::before {
      margin-right: 8px;
    }

    .rdb-container h3 {
      padding-top: 5px;
      padding-bottom: 3px;
    }
  }

  .rdb-headers .rdb-column h3 {
    font-size: 1em;
  }

  .rdb-evt-group-toggle,
  .rdb-evt-group-toggle:focus,
  .rdb-evt-group-toggle:hover {
    color: variables.$text-color;
  }

  .rdb-card-header .rdb-menu-issue a.rdb-menu-link,
  .rdb-compact-header .rdb-menu-issue a.rdb-menu-link,
  .rdb-card-title > a {
    background-image: none;

    &::after {
      content: "\f013";
      display: inline-block;
      position: absolute;
      top: 1px;
      left: 2px;
      color: variables.$gray-600;
      font-family: FontAwesome;
    }
  }

  .rdb-property-tracker {
    padding-left: 0;
    background-image: none;

    &::before {
      content: "\f145";
      display: inline-block;
      margin-right: 4px;
      font-family: FontAwesome;
    }
  }

  .rdb-property-assignee {
    padding-left: 0;
    background-image: none;

    &::before {
      content: "\f007";
      display: inline-block;
      margin-right: 4px;
      font-family: FontAwesome;
    }
  }
}

#rdb-footer #rdb-legend .rdb-overdue {
  padding-right: 3px;
}


// Redmine Banner
// https://www.redmine.org/plugins/redmine_banner

#admin-menu .icon.redmine-banner {
  background-image: none;
}

#global_banner {
  .box {
    margin-bottom: variables.$line-height-computed;
  }

  .banner_info {
    @extend %fa-icon;

    padding: 0;
    background-image: none;

    &::before {
      @include variants.fa-custom-icon(fa-variables.$fa-var-circle-info);

      color: variables.$blue;
    }
  }

  .banner_warn {
    @extend %fa-icon;

    padding: 0;
    background-image: none;

    &::before {
      @include variants.fa-custom-icon(fa-variables.$fa-var-triangle-exclamation);

      color: variables.$orange;
    }
  }

  .banner_alert {
    @extend %fa-icon;

    padding: 0;
    background-image: none;

    &::before {
      @include variants.fa-custom-icon(fa-variables.$fa-var-circle-exclamation);

      color: variables.$red;
    }
  }

  .use_timer {
    @extend %fa-icon-after;

    padding: 0;
    background-image: none;

    &::after {
      @include variants.fa-custom-icon(fa-variables.$fa-var-clock);
    }
  }
}

body div.banner_area {
  @media screen and (max-width: variables.$redmine-responsive-max) {
    #main #content > & {
      margin-bottom: variables.$line-height-computed;
    }
  }

  .banner {
    @extend %fa-icon;

    margin: 0;
    padding: variables.$padding-large-vertical variables.$padding-large-horizontal;
    padding-left: variables.$padding-large-horizontal + 8px + 16px;
    border: 1px solid variables.$component-border;
    border-radius: variables.$border-radius-base;
    background: variables.$component-bg;
    color: variables.$component-color;

    @media screen and (min-width: variables.$redmine-responsive-min) {
      border-radius: 0;
    }

    &::before {
      @include variants.fa-custom-icon(fa-variables.$fa-var-info);

      margin-left: -(8px + 16px);
      float: left;
      line-height: variables.$line-height-computed;
    }

    &_info {
      border-color: variables.$flash-info-border;
      background-color: variables.$flash-info-bg;
      color: variables.$flash-info-text;

      &::before {
        @include variants.fa-custom-icon(fa-variables.$fa-var-info-circle);
      }
    }

    &_warn {
      border-color: variables.$flash-warning-border;
      background-color: variables.$flash-warning-bg;
      color: variables.$flash-warning-text;

      &::before {
        @include variants.fa-custom-icon(fa-variables.$fa-var-warning);
      }

      a,
      ~ div a {
        color: variables.$flash-warning-link;
      }
    }

    &_alert {
      border-color: variables.$flash-error-border;
      background-color: variables.$flash-error-bg;
      color: variables.$flash-error-text;

      &::before {
        @include variants.fa-custom-icon(fa-variables.$fa-var-exclamation-circle);
      }

      a,
      ~ div a {
        color: variables.$flash-error-link;
      }
    }

    h1,
    h2,
    h3,
    h4,
    h5,
    h6,
    p,
    ul,
    ol {
      margin-bottom: variables.$line-height-computed * .5;

      &:last-child {
        margin-bottom: 0;
      }
    }

    a {
      text-decoration: underline;
    }
  }

  .banner_edit {
    a {
      margin-left: 5px;
    }
  }

  div.banner_more_info {
    opacity: .75;
    text-transform: uppercase;

    &:hover {
      opacity: 1;
    }
  }
}


// Redmine Hearts
// https://www.redmine.org/plugins/redmine_hearts

.journal > div + .contextual {
  padding-top: 0;
  padding-bottom: 0;
  border: 0;

  > .heart-link-with-count {
    display: block;
    position: relative;
    margin: -(variables.$line-height-computed * .5 + 1px) (variables.$bubble-padding-horizontal - variables.$padding-small-vertical) 0;
    float: right;
    border: 0;
    background-color: variables.$body-bg;
    text-align: right;
  }
}

.contextual {
  .icon-heart,
  .icon-heart-off {
    margin-left: variables.$padding-small-vertical;
    background-image: none;
  }

  .heart-link-with-count {
    margin-right: variables.$padding-small-vertical;
    margin-left: variables.$padding-small-vertical;

    > .heart-count-number {
      display: inline-block;
      min-width: 1em;
      margin: 0 0 0 3px;
      padding: 1px 4px;
      border-radius: variables.$border-radius-base;
      background-color: variables.$btn-default-bg;
      color: variables.$btn-default-color;
      text-align: center;

      &::before {
        content: "";
      }
    }
  }
}

#content > .contextual {
  > span.heart-link-with-count {
    padding: 0;
    border: 0;
    background: transparent;

    > a:first-child {
      margin-right: 0;
      margin-left: 4px;
      padding-right: math.floor(variables.$btn-padding-horizontal-small * .5);
      border-top-right-radius: 0;
      border-bottom-right-radius: 0;

      + a {
        min-width: unset;
        margin-left: 0;
        border-top-left-radius: 0;
        border-bottom-left-radius: 0;
      }
    }
  }
}

.controller-hearts .recent-heart-list li {
  padding: variables.$padding-large-vertical;
}

#wiki_form.new_content + .wiki_page--heart,
#wiki_form.new_content + .heart-link-with-count {
  display: none;
}


// Redmine Impersonate
// https://www.redmine.org/plugins/redmine_impersonate

#impersonate::before {
  content: "\f21b";
  display: inline-block;
  margin-right: 5px;
  font: normal normal normal 14px/1 FontAwesome;
}

#impersonation-bar {
  border-radius: 0;
}


// Redmine Recaptcha
// https://www.redmine.org/plugins/recaptcha

.new-user .g-recaptcha {
  padding-left: 170px;

  @media screen and (max-width: variables.$redmine-responsive-max) {
    padding-left: 0;
  }
}
